# Waidrin LangGraph Agent

A LangGraph-powered agent for managing the Waidrin codebase lifecycle, providing intelligent automation for development, testing, building, and deployment tasks.

## Features

- **🤖 Intelligent Code Analysis**: Analyze codebase structure, identify issues, and suggest improvements
- **🔄 Lifecycle Management**: Automated development lifecycle with phases for setup, analysis, planning, execution, and quality assurance
- **🛠️ Codebase Tools**: Comprehensive tools for file operations, code search, and analysis
- **🎮 Waidrin Integration**: Specialized tools for working with Waidrin's game engine, state management, and plugin system
- **📊 Event-Driven Architecture**: Real-time monitoring and event handling for development processes
- **🧪 Testing Support**: Automated test execution, coverage analysis, and test generation recommendations
- **🏗️ Build Automation**: Automated build processes with error handling and artifact management

## Installation

```bash
cd agents/langgraph-agent
npm install
```

## Configuration

Create a `.env` file in the agent directory:

```env
OPENAI_API_KEY=your_openai_api_key
OPENAI_BASE_URL=http://localhost:8080/v1/  # Optional, for local LLM servers
```

## Usage

### Development Agent

Run the development agent for general development tasks:

```bash
npm run agent:dev "Fix the character selection bug"
```

### Build Agent

Run the build agent for build and deployment tasks:

```bash
npm run agent:build
```

### Test Agent

Run the test agent for testing and quality assurance:

```bash
npm run agent:test
```

### Programmatic Usage

```typescript
import { WaidrinAgent } from "@waidrin/langgraph-agent";
import type { AgentConfig } from "@waidrin/langgraph-agent/types";

const config: AgentConfig = {
  model: "gpt-4",
  temperature: 0.1,
  maxIterations: 10,
  autoCommit: false,
  watchMode: true,
  projectRoot: process.cwd(),
  openaiApiKey: process.env.OPENAI_API_KEY,
};

const agent = new WaidrinAgent(config);

// Set up event listeners
agent.onEvent("task_started", (event) => {
  console.log(`Task started: ${event.data.task}`);
});

agent.onEvent("task_completed", (event) => {
  console.log(`Task completed: ${event.data.task}`);
});

// Run the agent
const result = await agent.run({
  currentTask: "Implement a new feature",
  codebaseContext: {
    projectRoot: process.cwd(),
    currentFiles: [],
    modifiedFiles: [],
  },
});
```

## Architecture

### Core Components

- **WaidrinAgent**: Main agent class with LangGraph state machine
- **WaidrinLifecycleManager**: Manages development lifecycle phases
- **WaidrinTools**: Specialized tools for Waidrin-specific operations
- **CodebaseTools**: General-purpose codebase manipulation tools

### State Machine

The agent follows a state machine pattern:

1. **Analyze**: Analyze current codebase state
2. **Plan**: Create detailed execution plan
3. **Execute**: Execute planned actions
4. **Review**: Review results and determine next steps
5. **Finalize**: Complete the task

### Event System

The agent emits events for monitoring and integration:

- `task_started`: When a task begins
- `task_completed`: When a task completes successfully
- `task_failed`: When a task fails
- `phase_started`: When a lifecycle phase begins
- `phase_completed`: When a lifecycle phase completes
- `error_occurred`: When an error occurs

## Tools

### Codebase Tools

- `readFile(filePath)`: Read file contents
- `writeFile(filePath, content)`: Write content to file
- `searchFiles(pattern)`: Search for files matching pattern
- `searchText(query, pattern)`: Search for text content in files
- `analyzeCodeStructure(filePath)`: Analyze code structure and extract metadata
- `executeCommand(command, args)`: Execute shell commands
- `getGitStatus()`: Get git status
- `getGitLog(limit)`: Get git commit history

### Waidrin Tools

- `getGameState()`: Get current game state
- `updateGameState(updates)`: Update game state
- `getSchemas()`: Get Zod schemas
- `addSchema(name, definition)`: Add new schema
- `getPrompts()`: Get LLM prompts
- `addPrompt(name, definition)`: Add new prompt
- `getComponents()`: Get React components
- `createComponent(name, code)`: Create new component
- `getViews()`: Get view components
- `createView(name, code)`: Create new view
- `getPlugins()`: Get plugin information
- `createPlugin(name, manifest, code)`: Create new plugin

## Development

### Project Structure

```
src/
├── core/           # Core agent implementation
├── integration/    # Waidrin integration layer
├── tools/          # Tool implementations
├── types/          # TypeScript type definitions
├── utils/          # Utility functions
└── examples/       # Example implementations

tests/              # Test files
docs/               # Documentation
config/             # Configuration files
```

### Building

```bash
npm run build
```

### Testing

```bash
npm run test
npm run test:watch
```

### Linting

```bash
npm run lint
npm run lint:fix
```

## Integration with Waidrin

The agent integrates with Waidrin's architecture:

- **State Management**: Works with Zustand state store
- **Plugin System**: Can create and manage plugins
- **Game Engine**: Understands game state and events
- **Component System**: Can create and modify React components
- **Backend Integration**: Works with LLM backends

## Examples

### Bug Fix Example

```bash
npm run agent:dev "Fix the character selection bug in CharacterSelect.tsx"
```

### Feature Implementation Example

```bash
npm run agent:dev "Add a new location type 'dungeon' to the game"
```

### Refactoring Example

```bash
npm run agent:dev "Refactor the state management to use a more efficient pattern"
```

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests
5. Submit a pull request

## License

AGPL-3.0-or-later (same as Waidrin)

## Support

For questions and support, please open an issue in the main Waidrin repository.
