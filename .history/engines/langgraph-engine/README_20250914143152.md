# Waidrin LangGraph Game Engine

A LangGraph-powered game engine designed to replace the linear state machine in Waidrin with a more flexible, dynamic, and intelligent game flow system.

## 🎯 Vision

Transform Waidrin from a linear state machine into a dynamic, intelligent game engine that can:
- Handle complex branching narratives
- Maintain rich character relationships and memory
- Support human-in-the-loop interactions
- Enable real-time story adaptation
- Provide extensible plugin architecture

## 🏗️ Architecture Overview

### Current Waidrin Engine
```
welcome → connection → genre → character → scenario → chat
```

### Proposed LangGraph Engine
```
[Welcome] → [Connection] → [Genre] → [Character] → [Scenario] → [Chat]
    ↓           ↓           ↓          ↓           ↓         ↓
[Memory] ← [Narration] ← [Actions] ← [Location] ← [Events] ← [State]
    ↓           ↓           ↓          ↓           ↓         ↓
[Plugin] ← [Streaming] ← [Tools] ← [Backend] ← [Context] ← [Memory]
```

## 📁 Development Structure

```
engines/langgraph-engine/
├── src/
│   ├── core/                    # Core engine implementation
│   │   ├── game-engine.ts      # Main LangGraph game engine
│   │   ├── state-manager.ts    # Game state management
│   │   └── event-system.ts     # Event handling system
│   ├── nodes/                   # Game-specific nodes
│   │   ├── welcome-node.ts     # Welcome screen logic
│   │   ├── connection-node.ts  # Connection setup
│   │   ├── genre-node.ts       # Genre selection
│   │   ├── character-node.ts   # Character creation
│   │   ├── scenario-node.ts    # Scenario setup
│   │   ├── chat-node.ts        # Main game chat
│   │   ├── narration-node.ts   # Story narration
│   │   ├── action-node.ts      # Action generation
│   │   └── location-node.ts    # Location management
│   ├── tools/                   # Game tools
│   │   ├── llm-tools.ts        # LLM interaction tools
│   │   ├── character-tools.ts  # Character management
│   │   ├── location-tools.ts   # Location management
│   │   ├── memory-tools.ts     # Memory and context
│   │   └── plugin-tools.ts     # Plugin integration
│   ├── types/                   # Type definitions
│   │   ├── game-state.ts       # Game state schema
│   │   ├── node-types.ts       # Node type definitions
│   │   ├── event-types.ts      # Event type definitions
│   │   └── tool-types.ts       # Tool type definitions
│   └── utils/                   # Utility functions
│       ├── state-helpers.ts    # State manipulation helpers
│       ├── prompt-builders.ts  # Prompt construction
│       └── validation.ts       # Data validation
├── examples/                    # Example implementations
│   ├── basic-game.ts          # Basic game setup
│   ├── advanced-features.ts   # Advanced game features
│   └── plugin-example.ts      # Plugin development
├── tests/                      # Test files
│   ├── engine.test.ts         # Engine tests
│   ├── nodes.test.ts          # Node tests
│   └── tools.test.ts          # Tool tests
├── docs/                       # Documentation
│   ├── architecture.md        # Detailed architecture
│   ├── node-development.md    # Node development guide
│   ├── tool-development.md    # Tool development guide
│   └── migration-guide.md     # Migration from current engine
└── config/                     # Configuration
    ├── engine.config.ts       # Engine configuration
    └── node-configs.ts        # Node-specific configs
```

## 🚀 Development Phases

### Phase 1: Core Foundation
- [ ] Create basic LangGraph engine structure
- [ ] Define game state schema compatible with existing Waidrin state
- [ ] Implement core state management
- [ ] Create event system

### Phase 2: Node Implementation
- [ ] Implement all game nodes (welcome, connection, genre, etc.)
- [ ] Create tool system for LLM interactions
- [ ] Add memory and context management
- [ ] Implement streaming support

### Phase 3: Integration
- [ ] Integrate with existing Waidrin backend
- [ ] Maintain compatibility with current UI
- [ ] Add plugin system integration
- [ ] Implement human-in-the-loop features

### Phase 4: Advanced Features
- [ ] Add dynamic story branching
- [ ] Implement character relationship tracking
- [ ] Create scene summarization
- [ ] Add advanced memory management

### Phase 5: Migration
- [ ] Create migration tools
- [ ] Add backward compatibility
- [ ] Performance optimization
- [ ] Documentation and examples

## 🎮 Key Features

### Dynamic Game Flow
- Non-linear story progression
- Conditional branching based on player choices
- Dynamic node creation and removal
- Real-time story adaptation

### Memory System
- Character relationship tracking
- Scene and event memory
- Player preference learning
- Long-term story continuity

### Human-in-the-Loop
- Natural player interaction points
- Real-time choice presentation
- Dynamic story modification
- Player agency preservation

### Plugin Architecture
- Custom node types
- Plugin-specific tools
- Event system integration
- Dynamic feature addition

### Streaming Support
- Real-time narration
- Progressive story updates
- Live character interactions
- Dynamic action generation

## 🔧 Development Tools

### Engine Development
```bash
# Start development server
npm run dev:engine

# Run engine tests
npm run test:engine

# Build engine
npm run build:engine
```

### Node Development
```bash
# Create new node
npm run create:node <node-name>

# Test specific node
npm run test:node <node-name>

# Debug node execution
npm run debug:node <node-name>
```

### Tool Development
```bash
# Create new tool
npm run create:tool <tool-name>

# Test tool functionality
npm run test:tool <tool-name>
```

## 📚 Documentation

- **Architecture Guide**: Detailed system architecture
- **Node Development**: How to create custom nodes
- **Tool Development**: How to create custom tools
- **Migration Guide**: Moving from current engine
- **API Reference**: Complete API documentation

## 🤝 Contributing

1. Fork the repository
2. Create a feature branch
3. Implement your changes
4. Add tests
5. Submit a pull request

## 📄 License

AGPL-3.0-or-later (same as Waidrin)

---

This LangGraph engine will provide a powerful, flexible foundation for the next generation of Waidrin's game engine while maintaining compatibility with the existing codebase.
