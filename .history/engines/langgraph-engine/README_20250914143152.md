# Waidrin LangGraph Game Engine

A LangGraph-powered game engine designed to replace the linear state machine in Waidrin with a more flexible, dynamic, and intelligent game flow system.

## ğŸ¯ Vision

Transform Waidrin from a linear state machine into a dynamic, intelligent game engine that can:
- Handle complex branching narratives
- Maintain rich character relationships and memory
- Support human-in-the-loop interactions
- Enable real-time story adaptation
- Provide extensible plugin architecture

## ğŸ—ï¸ Architecture Overview

### Current Waidrin Engine
```
welcome â†’ connection â†’ genre â†’ character â†’ scenario â†’ chat
```

### Proposed LangGraph Engine
```
[Welcome] â†’ [Connection] â†’ [Genre] â†’ [Character] â†’ [Scenario] â†’ [Chat]
    â†“           â†“           â†“          â†“           â†“         â†“
[Memory] â† [Narration] â† [Actions] â† [Location] â† [Events] â† [State]
    â†“           â†“           â†“          â†“           â†“         â†“
[Plugin] â† [Streaming] â† [Tools] â† [Backend] â† [Context] â† [Memory]
```

## ğŸ“ Development Structure

```
engines/langgraph-engine/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/                    # Core engine implementation
â”‚   â”‚   â”œâ”€â”€ game-engine.ts      # Main LangGraph game engine
â”‚   â”‚   â”œâ”€â”€ state-manager.ts    # Game state management
â”‚   â”‚   â””â”€â”€ event-system.ts     # Event handling system
â”‚   â”œâ”€â”€ nodes/                   # Game-specific nodes
â”‚   â”‚   â”œâ”€â”€ welcome-node.ts     # Welcome screen logic
â”‚   â”‚   â”œâ”€â”€ connection-node.ts  # Connection setup
â”‚   â”‚   â”œâ”€â”€ genre-node.ts       # Genre selection
â”‚   â”‚   â”œâ”€â”€ character-node.ts   # Character creation
â”‚   â”‚   â”œâ”€â”€ scenario-node.ts    # Scenario setup
â”‚   â”‚   â”œâ”€â”€ chat-node.ts        # Main game chat
â”‚   â”‚   â”œâ”€â”€ narration-node.ts   # Story narration
â”‚   â”‚   â”œâ”€â”€ action-node.ts      # Action generation
â”‚   â”‚   â””â”€â”€ location-node.ts    # Location management
â”‚   â”œâ”€â”€ tools/                   # Game tools
â”‚   â”‚   â”œâ”€â”€ llm-tools.ts        # LLM interaction tools
â”‚   â”‚   â”œâ”€â”€ character-tools.ts  # Character management
â”‚   â”‚   â”œâ”€â”€ location-tools.ts   # Location management
â”‚   â”‚   â”œâ”€â”€ memory-tools.ts     # Memory and context
â”‚   â”‚   â””â”€â”€ plugin-tools.ts     # Plugin integration
â”‚   â”œâ”€â”€ types/                   # Type definitions
â”‚   â”‚   â”œâ”€â”€ game-state.ts       # Game state schema
â”‚   â”‚   â”œâ”€â”€ node-types.ts       # Node type definitions
â”‚   â”‚   â”œâ”€â”€ event-types.ts      # Event type definitions
â”‚   â”‚   â””â”€â”€ tool-types.ts       # Tool type definitions
â”‚   â””â”€â”€ utils/                   # Utility functions
â”‚       â”œâ”€â”€ state-helpers.ts    # State manipulation helpers
â”‚       â”œâ”€â”€ prompt-builders.ts  # Prompt construction
â”‚       â””â”€â”€ validation.ts       # Data validation
â”œâ”€â”€ examples/                    # Example implementations
â”‚   â”œâ”€â”€ basic-game.ts          # Basic game setup
â”‚   â”œâ”€â”€ advanced-features.ts   # Advanced game features
â”‚   â””â”€â”€ plugin-example.ts      # Plugin development
â”œâ”€â”€ tests/                      # Test files
â”‚   â”œâ”€â”€ engine.test.ts         # Engine tests
â”‚   â”œâ”€â”€ nodes.test.ts          # Node tests
â”‚   â””â”€â”€ tools.test.ts          # Tool tests
â”œâ”€â”€ docs/                       # Documentation
â”‚   â”œâ”€â”€ architecture.md        # Detailed architecture
â”‚   â”œâ”€â”€ node-development.md    # Node development guide
â”‚   â”œâ”€â”€ tool-development.md    # Tool development guide
â”‚   â””â”€â”€ migration-guide.md     # Migration from current engine
â””â”€â”€ config/                     # Configuration
    â”œâ”€â”€ engine.config.ts       # Engine configuration
    â””â”€â”€ node-configs.ts        # Node-specific configs
```

## ğŸš€ Development Phases

### Phase 1: Core Foundation
- [ ] Create basic LangGraph engine structure
- [ ] Define game state schema compatible with existing Waidrin state
- [ ] Implement core state management
- [ ] Create event system

### Phase 2: Node Implementation
- [ ] Implement all game nodes (welcome, connection, genre, etc.)
- [ ] Create tool system for LLM interactions
- [ ] Add memory and context management
- [ ] Implement streaming support

### Phase 3: Integration
- [ ] Integrate with existing Waidrin backend
- [ ] Maintain compatibility with current UI
- [ ] Add plugin system integration
- [ ] Implement human-in-the-loop features

### Phase 4: Advanced Features
- [ ] Add dynamic story branching
- [ ] Implement character relationship tracking
- [ ] Create scene summarization
- [ ] Add advanced memory management

### Phase 5: Migration
- [ ] Create migration tools
- [ ] Add backward compatibility
- [ ] Performance optimization
- [ ] Documentation and examples

## ğŸ® Key Features

### Dynamic Game Flow
- Non-linear story progression
- Conditional branching based on player choices
- Dynamic node creation and removal
- Real-time story adaptation

### Memory System
- Character relationship tracking
- Scene and event memory
- Player preference learning
- Long-term story continuity

### Human-in-the-Loop
- Natural player interaction points
- Real-time choice presentation
- Dynamic story modification
- Player agency preservation

### Plugin Architecture
- Custom node types
- Plugin-specific tools
- Event system integration
- Dynamic feature addition

### Streaming Support
- Real-time narration
- Progressive story updates
- Live character interactions
- Dynamic action generation

## ğŸ”§ Development Tools

### Engine Development
```bash
# Start development server
npm run dev:engine

# Run engine tests
npm run test:engine

# Build engine
npm run build:engine
```

### Node Development
```bash
# Create new node
npm run create:node <node-name>

# Test specific node
npm run test:node <node-name>

# Debug node execution
npm run debug:node <node-name>
```

### Tool Development
```bash
# Create new tool
npm run create:tool <tool-name>

# Test tool functionality
npm run test:tool <tool-name>
```

## ğŸ“š Documentation

- **Architecture Guide**: Detailed system architecture
- **Node Development**: How to create custom nodes
- **Tool Development**: How to create custom tools
- **Migration Guide**: Moving from current engine
- **API Reference**: Complete API documentation

## ğŸ¤ Contributing

1. Fork the repository
2. Create a feature branch
3. Implement your changes
4. Add tests
5. Submit a pull request

## ğŸ“„ License

AGPL-3.0-or-later (same as Waidrin)

---

This LangGraph engine will provide a powerful, flexible foundation for the next generation of Waidrin's game engine while maintaining compatibility with the existing codebase.
